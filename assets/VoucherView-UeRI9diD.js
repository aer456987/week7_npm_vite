import{a as r}from"./axios-G2rPRu76.js";import{_ as v,o as n,c as i,a as e,w as u,v as m,j as M,r as V,F as b,e as y,d as f,t as _}from"./index-nbSx67QQ.js";import{M as g}from"./bootstrap.esm-TTjMTX3M.js";import{D}from"./DelProductModal-8BpRnukm.js";const x={data(){return{voucher:null,emitVoucher:{},due_date:""}},props:["tempVoucher","isNew"],methods:{modelOpen(){this.voucher.show()},modalClose(){this.voucher.hide()}},mounted(){this.voucher=new g(this.$refs.VoucherModal),this.emitVoucher=this.tempVoucher},watch:{tempProducts(){this.emitVoucher=this.tempVoucher;const t=new Date(this.tempVoucher.due_date*1e3).toISOString().split("T");[this.due_date]=t},due_date(){this.emitVoucher.due_date=Math.floor(new Date(this.due_date)/1e3)}}},C={id:"VoucherModal",ref:"VoucherModal",class:"modal fade",tabindex:"-1","aria-labelledby":"VoucherModalLabel","aria-hidden":"true"},T={class:"modal-dialog",role:"document"},E={class:"modal-content"},N={class:"modal-header"},P={id:"VoucherModalLabel",class:"modal-title"},U={key:0},I={key:1},L=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),O={class:"modal-body"},S={class:"mb-3"},A=e("label",{for:"title",class:"form-label"},"優惠卷標題",-1),R={class:"mb-3"},B=e("label",{for:"coupon_code",class:"form-label"},"優惠碼",-1),F={class:"mb-3"},H=e("label",{for:"due_date"},"使用期限",-1),j={class:"mb-3"},z=e("label",{for:"title",class:"form-label"},"折扣",-1),q={class:"mb-3"},G={class:"form-check"},J=e("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),K={class:"modal-footer"},Q=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function W(t,o,a,$,s,c){return n(),i("div",C,[e("div",T,[e("div",E,[e("div",N,[e("h5",P,[a.isNew?(n(),i("span",U,"新增優惠卷")):(n(),i("span",I,"編輯優惠卷"))]),L]),e("div",O,[e("div",S,[A,u(e("input",{"onUpdate:modelValue":o[0]||(o[0]=l=>s.emitVoucher.title=l),id:"title",type:"text",class:"form-control",placeholder:"請輸入優惠卷標題"},null,512),[[m,s.emitVoucher.title]])]),e("div",R,[B,u(e("input",{"onUpdate:modelValue":o[1]||(o[1]=l=>s.emitVoucher.code=l),id:"coupon_code",type:"text",class:"form-control",placeholder:"請輸入優惠碼"},null,512),[[m,s.emitVoucher.code]])]),e("div",F,[H,u(e("input",{"onUpdate:modelValue":o[2]||(o[2]=l=>s.due_date=l),id:"due_date",type:"date",class:"form-control"},null,512),[[m,s.due_date]])]),e("div",j,[z,u(e("input",{"onUpdate:modelValue":o[3]||(o[3]=l=>s.emitVoucher.percent=l),id:"title",type:"text",class:"form-control",placeholder:"請輸入折扣百分比"},null,512),[[m,s.emitVoucher.percent,void 0,{number:!0}]])]),e("div",q,[e("div",G,[u(e("input",{"true-value":1,"false-value":0,"onUpdate:modelValue":o[4]||(o[4]=l=>s.emitVoucher.is_enabled=l),id:"is_enabled",class:"form-check-input",type:"checkbox"},null,512),[[M,s.emitVoucher.is_enabled]]),J])])]),e("div",K,[Q,e("button",{type:"button",class:"btn btn-primary",onClick:o[5]||(o[5]=l=>t.$emit("edit-Voucher",s.emitVoucher))}," 確認 ")])])])],512)}const X=v(x,[["render",W]]);var Y={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"reirei",BASE_URL:"/week7_npm_vite/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:h,VITE_PATH:p}=Y,Z={data(){return{voucher:{},tempVoucher:{title:"",is_enabled:0,percent:100,code:""},isNew:!1}},methods:{cheakLongin(){r.post(`${h}/api/user/check`).then(t=>{this.getVoucherData()}).catch(t=>{alert(t.response.data.message),this.$router.push("/login")})},getVoucherData(){r.get(`${h}/api/${p}/admin/coupons`).then(t=>{this.voucher=t.data.coupons,console.log(this.voucher)}).catch(t=>{alert(t.response.data.message)})},openModel(t,o){t==="new"?(this.isNew=!0,this.tempVoucher={due_data:new Date().getTime()/1e3},this.$refs.voucher.modelOpen()):t==="edit"?(this.isNew=!1,this.tempVoucher={...o},this.$refs.voucher.modelOpen()):t==="dele"&&(this.tempVoucher={...o},this.$refs.deModal.modelOpen())},editVoucher(){let t=`${h}/api/${p}/admin/coupon`,o="post";this.isNew||(t=`${h}/api/${p}/admin/coupon/${this.tempVoucher.id}`,o="put"),r[o](t,{data:this.tempVoucher}).then(a=>{alert(a.data.message),this.$refs.voucher.modalClose(),this.getVoucherData()}).catch(a=>{alert(a.response.data.message)})},delProduct(){r.delete(`${h}/api/${p}/admin/coupon/${this.tempVoucher.id}`).then(t=>{alert(t.data.message),this.$refs.deModal.modalClose(),this.getVoucherData()}).catch(t=>{alert(t.response.data.message)})}},mounted(){const t=document.cookie.replace(/(?:(?:^|.*;\s*)kawaToken\s*=\s*([^;]*).*$)|^.*$/,"$1");r.defaults.headers.common.Authorization=t,this.getVoucherData()},components:{VoucherModal:X,DelProductModal:D}},ee={class:"container"},te={class:"text-end mt-4"},oe={class:"text-end mt-4"},se={class:"table mt-4"},le=e("thead",null,[e("tr",null,[e("th",{width:"120"},"名稱"),e("th",{width:"120"},"折扣百分比"),e("th",{width:"120"},"到期日"),e("th",{width:"120"},"是否啟用"),e("th",{width:"120"},"編輯")])],-1),de={key:0,class:"text-success"},ne={key:1},ie={class:"btn-group"},ae=["onClick"],ce=["onClick"];function re(t,o,a,$,s,c){const l=V("VoucherModal"),k=V("DelProductModal");return n(),i(b,null,[e("div",ee,[e("div",te,[e("button",{class:"btn btn-primary",onClick:o[0]||(o[0]=d=>c.openModel("new",t.item))}," 建立優惠卷 ")]),e("div",oe,[e("table",se,[le,e("tbody",null,[(n(!0),i(b,null,y(s.voucher,d=>(n(),i("tr",{key:d.id},[e("td",null,_(d.title),1),e("td",null,_(d.percent)+"%",1),e("td",null,_(t.$date.date(d.due_date)),1),e("td",null,[d.is_enabled?(n(),i("span",de,"啟用")):(n(),i("span",ne,"未啟用"))]),e("td",null,[e("div",ie,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:w=>c.openModel("edit",d)}," 編輯 ",8,ae),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:w=>c.openModel("dele",d)}," 刪除 ",8,ce)])])]))),128))])])])]),f(l,{"is-New":s.isNew,"temp-Voucher":s.tempVoucher,onEditVoucher:c.editVoucher,ref:"voucher"},null,8,["is-New","temp-Voucher","onEditVoucher"]),f(k,{onDelItem:c.delProduct,"temp-Voucher":s.tempVoucher,ref:"deModal"},null,8,["onDelItem","temp-Voucher"])],64)}const _e=v(Z,[["render",re]]);export{_e as default};
